
# KotlinでRetrofitを使いやすくするちょっとした工夫

第一声は資料名 + 発表させていただきます。よろしくお願いします。

第二声は　#jkugタグを付けてTwitterに資料を流しておきましたので、合わせてご覧ください。

## 自己紹介

* 名前 (TwitterユーザID, Github)
* 会社

## Kotlin 1.0 おめでとう

今後が楽しみですね。

## 概要

DoorKeeperと同じような **イベント支援サービス** のConnpass APIに対するRetrofit Serviceを考える。
その際、

* Javaで定義されたService
* KotlinでServiceを作成

この2パターンで作ったServiceをKotlinで使う場合、より使いやすくできないかみていく。

## Connpass APIの最小限

実際には色々な検索クエリが設定できるが今回は次の3つ対象に考える。

* 検索キーワード
* 検索結果の **イベント** 表示順
* イベントを絞り込むための開催日

~~必須とオプション~~

レスポンスとしてマッチした *イベント情報* が返ってくるAPI。

## Javaで定義されたService1

先ほどの検索クエリに対応したServiceをJavaで書く。

全クエリ指定の場合はいいが、
キーワードだけでいい場合は **無駄にnull** を指定する。

汎用的に使える反面、もっとクエリが増えると ~~fabric~~ みたいに大変になる。

## Kotlinで改善

Kotlinでこのサービスを使う場合、せっかくなので
拡張関数を定義 + デフォルト引数を使って改善してみる例。

**キーワードは必須でそれ以外はオプション** という感じ。

更に 表示順は取る値が決まっているので、enumにすることでより安全に使えようになる。

使う時も必須のキーワードと、指定したいオプションのみでいいのでシンプルに書ける。


## KotlinでServiceを定義する場合

Kotlinでサービスを定義する場合、
先ほどの拡張関数と同じメソッドをインターフェースに定義できる。

## 改善例

用途に合わせた拡張もありではないかと思います。
カレンダーからから日付を選択したらDateオブジェクトだったら、という場合

検索クエリとしては yyyymmmdd 形式にしないといけないので、そのまま使えない。
そこで拡張関数を作成し、その中でDateオブジェクトをformatしている。

これにより、Serviceを使う側に変換の手間がかからなくなるのでよくない？

## まとめ
* デフォルト引数と適宜拡張関数でシンプルなインターフェース
* fabricのようにならないようにしましょう！

## ご清聴ありがとうございました
